m = function () {
    var self = this;
    this.links.forEach(function (link) {
        emit(link.url, {
            count: 1,
            ids: [{
                id: self.facebookId
              , mutualFriends: self.mutualFriends.map(function (mutualFriend) {
                    return mutualFriend.facebookId;
                })
            }]
        });
    });
}

r = function (key, values) {
    var ids = [], cnt = 0;
    values.forEach(function (value) {
        ids = ids.concat(value.ids);
        cnt += i.count;
    });
    return {
        count: cnt,
        ids: ids
    };
}

f = function (key, value) {
    value.ids.forEach(function (id) {
        var cnt = 0;
        id.mutualFriends.forEach(function (mutualFriend) {
            //TODO for should be faster
            if (value.ids.filter(function (id1) {
                return mutualFriend == id1.id;
            }).length != 0) {
                ++cnt;
            }});
        i.mutualCount = cnt;
        i.mutualPercent = 100 * cnt / i.mutualFriends.length;//NaN if 0
    });
    return v;
}